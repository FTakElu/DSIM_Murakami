<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Pacientes - DSIM</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #374151;
            background-color: #f9fafb;
        }
        
        /* Header */
        .dashboard-header {
            background: linear-gradient(135deg, #2563eb 0%, #059669 100%);
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .header-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
                .btn-add {
            background: #2563eb;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .btn-add:hover {
            background: #f8fafc;
            color: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .page-header {
            margin-bottom: 2rem;
        }
        
        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: #111827;
            margin-bottom: 0.5rem;
        }
        
        .page-subtitle {
            color: #6b7280;
            font-size: 1.1rem;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #2563eb;
        }
        
        .stat-card.success { border-left-color: #059669; }
        .stat-card.warning { border-left-color: #f59e0b; }
        .stat-card.danger { border-left-color: #dc2626; }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #111827;
            line-height: 1;
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        
        .stat-icon {
            float: right;
            font-size: 1.5rem;
            opacity: 0.7;
        }
        
        /* Patients Grid */
        .patients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
        }
        
        .patient-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 2rem;
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
        }
        
        .patient-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .patient-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .patient-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2563eb, #059669);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            margin-right: 1rem;
        }
        
        .patient-info h3 {
            color: #111827;
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }
        
        .patient-info p {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .vitals-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .vital-item {
            text-align: center;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 8px;
        }
        
        .vital-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .vital-icon.normal { color: #059669; }
        .vital-icon.warning { color: #f59e0b; }
        .vital-icon.danger { color: #dc2626; }
        
        .vital-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
        }
        
        .vital-label {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        .patient-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .btn-primary {
            background: #2563eb;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1e40af;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #374151;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 1.5rem 2rem;
            background: linear-gradient(135deg, #2563eb 0%, #059669 100%);
            color: white;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .modal-close {
            font-size: 2rem;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .modal-close:hover {
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid #e5e7eb;
        }

        /* Form Styles para os modais */
        .form-section {
            margin-bottom: 2rem;
        }

        .form-section h3 {
            color: #374151;
            font-size: 1.25rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* Details Modal Styles */
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .detail-card {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .detail-card h4 {
            color: #2563eb;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .detail-item {
            margin-bottom: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .detail-label {
            font-weight: 500;
            color: #374151;
        }

        .detail-value {
            color: #6b7280;
            text-align: right;
        }

        .vital-sign {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.875rem;
        }

        .vital-sign.normal { background: #d1fae5; color: #047857; }
        .vital-sign.warning { background: #fef3c7; color: #d97706; }
        .vital-sign.critical { background: #fee2e2; color: #dc2626; }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .patients-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 1rem auto;
            }

            .modal-body {
                padding: 1.5rem;
            }

            .modal-actions {
                flex-direction: column;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-heartbeat"></i> DSIM
            </div>
            <h1 class="header-title">Painel de Pacientes</h1>
                        <a href="adicionar-paciente.html" class="btn-add">
                <i class="fas fa-plus"></i>
                Adicionar Paciente
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <h2 class="page-title">Dashboard de Monitoramento</h2>
            <p class="page-subtitle">Acompanhe os sinais vitais e status de todos os pacientes em tempo real</p>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-users stat-icon"></i>
                <div class="stat-number" id="totalPatients">8</div>
                <div class="stat-label">Total de Pacientes</div>
            </div>
            <div class="stat-card success">
                <i class="fas fa-heart stat-icon"></i>
                <div class="stat-number" id="stablePatients">6</div>
                <div class="stat-label">Sinais Estáveis</div>
            </div>
            <div class="stat-card warning">
                <i class="fas fa-exclamation-triangle stat-icon"></i>
                <div class="stat-number" id="warningPatients">1</div>
                <div class="stat-label">Atenção Necessária</div>
            </div>
            <div class="stat-card danger">
                <i class="fas fa-bell stat-icon"></i>
                <div class="stat-number" id="criticalPatients">1</div>
                <div class="stat-label">Estado Crítico</div>
            </div>
        </div>

        <!-- Patients Grid -->
        <div class="patients-grid" id="patientsGrid">
            <!-- Os pacientes serão inseridos aqui via JavaScript -->
        </div>
    </main>



    <!-- Modal de Editar Paciente -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Editar Paciente</h2>
                <span class="modal-close" onclick="closeModal('editModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editPatientForm">
                    <div class="form-section">
                        <h3>Informações Pessoais</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Nome Completo *</label>
                                <input type="text" id="editName" name="name" class="form-input" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Data de Nascimento *</label>
                                <input type="date" id="editBirthdate" name="birthdate" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Gênero *</label>
                                <select id="editGender" name="gender" class="form-select" required>
                                    <option value="">Selecione</option>
                                    <option value="masculino">Masculino</option>
                                    <option value="feminino">Feminino</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Telefone</label>
                                <input type="tel" id="editPhone" name="phone" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Estado Civil</label>
                                <select id="editRelationship" name="relationship" class="form-select">
                                    <option value="">Selecione</option>
                                    <option value="solteiro">Solteiro(a)</option>
                                    <option value="casado">Casado(a)</option>
                                    <option value="divorciado">Divorciado(a)</option>
                                    <option value="viuvo">Viúvo(a)</option>
                                    <option value="uniao_estavel">União Estável</option>
                                    <option value="separado">Separado(a)</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Quarto/Leito</label>
                                <input type="text" id="editRoom" name="room" class="form-input">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Informações Médicas</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Tipo Sanguíneo</label>
                                <select id="editBloodType" name="bloodType" class="form-select">
                                    <option value="">Selecione</option>
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Alergias</label>
                                <input type="text" id="editAllergies" name="allergies" class="form-input">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Condições Médicas</label>
                            <textarea id="editMedicalConditions" name="medicalConditions" class="form-textarea"></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Contato de Emergência</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Nome do Contato</label>
                                <input type="text" id="editEmergencyName" name="emergencyName" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Telefone de Emergência</label>
                                <input type="tel" id="editEmergencyPhone" name="emergencyPhone" class="form-input">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Email de Emergência</label>
                                <input type="email" id="editEmergencyEmail" name="emergencyEmail" class="form-input">
                            </div>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('editModal')">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i> Salvar Alterações
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Variável para armazenar os pacientes carregados do backend
        let patients = [];

        // Função para buscar pacientes do backend
        async function carregarPacientes() {
            try {
                const response = await fetch('/api/pacientes');
                if (response.ok) {
                    const pacientesData = await response.json();
                    
                    // Converter dados do backend para formato usado no frontend
                    patients = pacientesData.map(paciente => {
                        const idade = calcularIdade(paciente.dataNascimento);
                        const sinais = paciente.sinaisVitais || {};
                        
                        return {
                            id: paciente.id,
                            name: paciente.nome,
                            age: idade,
                            room: formatarEstadoCivil(paciente.relacionamento),
                            heartRate: sinais.batimentos || 0,
                            oxygen: sinais.oxigenio || 0,
                            temperature: sinais.temperatura || 0,
                            status: determinarStatus(sinais)
                        };
                    });
                    
                    console.log('Pacientes carregados:', patients);
                } else {
                    console.error('Erro ao carregar pacientes');
                    patients = [];
                }
            } catch (error) {
                console.error('Erro na requisição:', error);
                patients = [];
            }
        }

        // Função para calcular idade a partir da data de nascimento
        function calcularIdade(dataNascimento) {
            if (!dataNascimento) return 'N/A';
            const hoje = new Date();
            const nascimento = new Date(dataNascimento);
            let idade = hoje.getFullYear() - nascimento.getFullYear();
            const mes = hoje.getMonth() - nascimento.getMonth();
            if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
                idade--;
            }
            return idade;
        }

        // Função para formatar estado civil
        function formatarEstadoCivil(relacionamento) {
            if (!relacionamento) return 'N/A';
            
            const estados = {
                'solteiro': 'Solteiro(a)',
                'casado': 'Casado(a)', 
                'divorciado': 'Divorciado(a)',
                'viuvo': 'Viúvo(a)',
                'uniao_estavel': 'União Estável',
                'separado': 'Separado(a)'
            };
            
            return estados[relacionamento] || relacionamento;
        }

        // Função para determinar status baseado nos sinais vitais
        function determinarStatus(sinais) {
            if (!sinais.oxigenio || !sinais.temperatura || !sinais.batimentos) {
                return 'normal';
            }

            // Critérios para status crítico
            if (sinais.oxigenio < 90 || sinais.temperatura > 38.5 || sinais.batimentos > 120 || sinais.batimentos < 50) {
                return 'critical';
            }
            
            // Critérios para status de atenção
            if (sinais.oxigenio < 95 || sinais.temperatura > 37.5 || sinais.batimentos > 100 || sinais.batimentos < 60) {
                return 'warning';
            }
            
            return 'normal';
        }



        // Função para obter classe do status
        function getStatusClass(status) {
            switch(status) {
                case 'critical': return 'danger';
                case 'warning': return 'warning';
                default: return 'normal';
            }
        }

        // Função para obter iniciais do nome
        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase();
        }

        // Função para renderizar pacientes
        function renderPatients() {
            const grid = document.getElementById('patientsGrid');
            
            grid.innerHTML = patients.map(patient => `
                <div class="patient-card">
                    <div class="patient-header">
                        <div class="patient-avatar">
                            ${getInitials(patient.name)}
                        </div>
                        <div class="patient-info">
                            <h3>${patient.name}</h3>
                            <p>${patient.age} anos • ${patient.room !== 'N/A' ? patient.room : 'Estado civil não informado'}</p>
                        </div>
                    </div>
                    
                    <div class="vitals-grid">
                        <div class="vital-item">
                            <div class="vital-icon ${getStatusClass(patient.status)}">
                                <i class="fas fa-heartbeat"></i>
                            </div>
                            <div class="vital-value">${patient.heartRate}</div>
                            <div class="vital-label">BPM</div>
                        </div>
                        <div class="vital-item">
                            <div class="vital-icon ${patient.oxygen < 95 ? 'danger' : 'normal'}">
                                <i class="fas fa-lungs"></i>
                            </div>
                            <div class="vital-value">${patient.oxygen}%</div>
                            <div class="vital-label">SpO₂</div>
                        </div>
                        <div class="vital-item">
                            <div class="vital-icon ${patient.temperature > 37.5 ? 'danger' : 'normal'}">
                                <i class="fas fa-thermometer-half"></i>
                            </div>
                            <div class="vital-value">${patient.temperature}°C</div>
                            <div class="vital-label">Temp</div>
                        </div>
                    </div>
                    
                    <div class="patient-actions">
                        <button class="btn btn-primary" onclick="viewPatient(${patient.id})">
                            <i class="fas fa-eye"></i> Ver Detalhes
                        </button>
                        <button class="btn btn-secondary" onclick="editPatient(${patient.id})">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Funções de ação
        function addPatient() {
            alert('Funcionalidade de adicionar paciente será implementada.');
        }

        // Variável para armazenar o ID do paciente sendo editado
        let currentPatientId = null;

        // Função para abrir modal
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        // Função para fechar modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            currentPatientId = null;
        }

        // Fechar modal clicando fora dele
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                    currentPatientId = null;
                }
            });
        }

        // Função para buscar dados completos do paciente do backend
        async function buscarPacienteCompleto(id) {
            try {
                const response = await fetch(`/api/pacientes/${id}`);
                if (response.ok) {
                    return await response.json();
                }
            } catch (error) {
                console.error('Erro ao buscar paciente:', error);
            }
            return null;
        }

        // Função para ver detalhes do paciente
        function viewPatient(id) {
            // Redirecionar para a página de detalhes com o ID do paciente
            window.location.href = `detalhes-paciente.html?id=${id}`;
        }

        // Função para editar paciente
        async function editPatient(id) {
            const paciente = await buscarPacienteCompleto(id);
            if (!paciente) {
                alert('Erro ao carregar dados do paciente');
                return;
            }

            currentPatientId = id;
            const contato = paciente.contatoEmergencial || {};
            const info = paciente.informacaoMedica || {};

            // Preencher formulário de edição
            document.getElementById('editName').value = paciente.nome || '';
            document.getElementById('editBirthdate').value = paciente.dataNascimento || '';
            document.getElementById('editGender').value = paciente.genero || '';
            document.getElementById('editPhone').value = paciente.telefone || '';
            document.getElementById('editRelationship').value = paciente.relacionamento || '';
            document.getElementById('editRoom').value = '';
            document.getElementById('editBloodType').value = info.tipoSangue || '';
            document.getElementById('editAllergies').value = info.deficiencia || '';
            document.getElementById('editMedicalConditions').value = info.problemasEspecificos || '';
            document.getElementById('editEmergencyName').value = contato.nome || '';
            document.getElementById('editEmergencyPhone').value = contato.telefone || '';
            document.getElementById('editEmergencyEmail').value = contato.email || '';

            openModal('editModal');
        }

        // Função para salvar alterações do paciente
        document.getElementById('editPatientForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!currentPatientId) {
                alert('Erro: ID do paciente não encontrado');
                return;
            }

            const formData = new FormData(this);
            const data = Object.fromEntries(formData);

            const pacienteData = {
                nome: data.name.trim(),
                dataNascimento: data.birthdate,
                genero: data.gender,
                telefone: data.phone || null,
                relacionamento: data.relationship || null,
                contatoEmergencial: {
                    nome: data.emergencyName || null,
                    telefone: data.emergencyPhone || null,
                    email: data.emergencyEmail || null,
                    instagram: null
                },
                informacaoMedica: {
                    tipoSangue: data.bloodType || null,
                    deficiencia: data.allergies || null,
                    problemasEspecificos: data.medicalConditions || null
                }
            };

            try {
                const response = await fetch(`/api/pacientes/${currentPatientId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(pacienteData)
                });

                if (response.ok) {
                    closeModal('editModal');
                    await carregarPacientes();
                    renderPatients();
                    updateStats();
                    alert('Paciente atualizado com sucesso!');
                } else {
                    alert('Erro ao atualizar paciente');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao atualizar paciente. Tente novamente.');
            }
        });

        // Atualizar estatísticas
        function updateStats() {
            const total = patients.length;
            const stable = patients.filter(p => p.status === 'normal').length;
            const warning = patients.filter(p => p.status === 'warning').length;
            const critical = patients.filter(p => p.status === 'critical').length;
            
            document.getElementById('totalPatients').textContent = total;
            document.getElementById('stablePatients').textContent = stable;
            document.getElementById('warningPatients').textContent = warning;
            document.getElementById('criticalPatients').textContent = critical;
        }

        // Inicializar página
        document.addEventListener('DOMContentLoaded', async function() {
            // Carregar pacientes do backend
            await carregarPacientes();
            renderPatients();
            updateStats();
            
            // Atualizar dados periodicamente
            setInterval(async () => {
                await carregarPacientes();
                renderPatients();
                updateStats();
            }, 30000); // Atualizar a cada 30 segundos
        });
    </script>
</body>
</html>